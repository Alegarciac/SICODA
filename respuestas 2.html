<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SICODA - Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
body { font-family:'Segoe UI', sans-serif; background:#f0f3f8; margin:0; color:#333;}
header{background:#fff;padding:15px;text-align:center;box-shadow:0 2px 10px rgba(0,0,0,0.1);border-bottom-left-radius:12px;border-bottom-right-radius:12px;}
header img{max-height:60px;}
.portada img{width:100%;max-height:250px;object-fit:cover;}
.container{max-width:900px;margin:30px auto;background:#fff;border-radius:12px;box-shadow:0 5px 20px rgba(0,0,0,0.08);padding:25px 30px;}
h2{text-align:center;margin-bottom:25px;color:#2c3e50;}
.tabs{display:flex;justify-content:center;margin-bottom:20px;gap:10px;}
.tab{padding:10px 20px;background:#3498db;color:#fff;border-radius:8px;cursor:pointer;transition:0.3s;}
.tab.active{background:#2980b9;}
.tab-content{display:none;}
.tab-content.active{display:block;}
form label{display:block;margin-bottom:5px;font-weight:600;color:#34495e;}
form input, form select, form textarea{width:100%;padding:12px 15px;margin-bottom:18px;border-radius:8px;border:1px solid #ccd1d9;transition:all 0.3s;font-size:15px;}
input:focus, select:focus, textarea:focus{border-color:#3498db;box-shadow:0 0 5px rgba(52,152,219,0.3);outline:none;}
textarea{resize:vertical;}
.input-icon{position:relative;}
.input-icon i{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:#7f8c8d;}
.input-icon input, .input-icon select, .input-icon textarea{padding-left:35px;}
button{background:#3498db;color:#fff;border:none;border-radius:8px;padding:14px;width:100%;font-size:16px;cursor:pointer;transition:all 0.3s;}
button:hover{background:#2980b9;transform:scale(1.02);}
.confirmation{margin-top:15px;padding:15px;border-radius:8px;background:#d4edda;color:#155724;text-align:center;border:1px solid #c3e6cb;opacity:0;transition:opacity 0.5s;}
.confirmation.show{opacity:1;}
.extra-field{display:none;transition:all 0.5s;}
table{width:100%;border-collapse:collapse;margin-top:20px;}
th,td{border:1px solid #ccc;padding:10px;text-align:left;font-size:14px;}
th{background:#3498db;color:#fff;}
@media(max-width:768px){.container{margin:20px;padding:20px;}}
</style>
</head>
<body>

<header>
<img src="https://raw.githubusercontent.com/Alegarciac/SICODA/main/LOGO%20HAP%20con%20R.png" alt="Logo HAP">
</header>

<div class="portada"><img src="https://raw.githubusercontent.com/Alegarciac/SICODA/main/PORTADA.jpg" alt="Portada SICODA"></div>

<div class="container">
<h2><i class="fa-solid fa-file-lines"></i> SICODA - √Årea de Calidad</h2>

<div class="tabs">
<div class="tab active" data-tab="form">Formulario</div>
<div class="tab" data-tab="history">Historial</div>
</div>

<div id="form" class="tab-content active">
<form id="documentForm">
<div class="input-icon"><i class="fa-solid fa-list-check"></i>
<select id="tipoSolicitud" name="tipoSolicitud" required>
<option value="">Tipo de solicitud...</option>
<option value="ALTA">ALTA</option>
<option value="MODIFICACI√ìN">MODIFICACI√ìN</option>
<option value="BAJA">BAJA</option>
</select></div>

<div class="input-icon"><i class="fa-solid fa-file-signature"></i>
<input type="text" id="nombreDocumento" name="nombreDocumento" placeholder="Nombre del documento" required></div>

<div class="input-icon"><i class="fa-solid fa-file-lines"></i>
<select id="tipoDocumento" name="tipoDocumento" required>
<option value="">Tipo de documento...</option>
<option value="Procedimiento">Procedimiento</option>
<option value="Instructivo">Instructivo</option>
<option value="Formato">Formato</option>
<option value="Pol√≠tica">Pol√≠tica</option>
<option value="Otro">Otro</option>
</select></div>

<div class="input-icon"><i class="fa-solid fa-building"></i>
<input type="text" id="areaResponsable" name="areaResponsable" placeholder="√Årea responsable" required></div>

<div class="input-icon"><i class="fa-solid fa-user"></i>
<input type="text" id="solicitante" name="solicitante" placeholder="Nombre del solicitante" required></div>

<div class="input-icon"><i class="fa-solid fa-calendar-days"></i>
<input type="date" id="fechaSolicitud" name="fechaSolicitud" required></div>

<div class="input-icon"><i class="fa-solid fa-clipboard"></i>
<textarea id="justificacion" name="justificacion" rows="3" placeholder="Justificaci√≥n" required></textarea></div>

<div class="extra-field" id="modBajaFields">
<div class="input-icon"><i class="fa-solid fa-barcode"></i>
<input type="text" id="codigoDocumento" name="codigoDocumento" placeholder="C√≥digo del documento"></div>
<div class="input-icon"><i class="fa-solid fa-layer-group"></i>
<input type="text" id="versionActual" name="versionActual" placeholder="Versi√≥n actual"></div>
</div>

<div class="extra-field" id="modFields">
<div class="input-icon"><i class="fa-solid fa-pencil"></i>
<input type="text" id="seccionesAfectadas" name="seccionesAfectadas" placeholder="Secciones afectadas"></div>
<div class="input-icon"><i class="fa-solid fa-edit"></i>
<textarea id="descripcionCambio" name="descripcionCambio" rows="2" placeholder="Descripci√≥n del cambio"></textarea></div>
</div>

<button type="submit"><i class="fa-solid fa-paper-plane"></i> Enviar Solicitud</button>
<div class="confirmation" id="confirmationMsg">
‚úÖ Gracias, tu solicitud ha sido generada.<br>
‚è≥ Redirigiendo al inicio...<br>
üéâ Te contactaremos pronto.
</div>
</form>
</div>

<div id="history" class="tab-content">
<h3>Historial de Solicitudes</h3>
<table id="historyTable">
<thead><tr><th>Tipo</th><th>Nombre</th><th>Tipo Doc</th><th>√Årea</th><th>Solicitante</th><th>Fecha</th></tr></thead>
<tbody></tbody>
</table>
</div>
</div>

<script>
const tipoSolicitud = document.getElementById('tipoSolicitud');
const modBajaFields = document.getElementById('modBajaFields');
const modFields = document.getElementById('modFields');
const form = document.getElementById('documentForm');
const confirmationMsg = document.getElementById('confirmationMsg');
const tabs = document.querySelectorAll('.tab');
const tabContents = document.querySelectorAll('.tab-content');
const historyTableBody = document.querySelector('#historyTable tbody');

// üîó URL de tu Apps Script ya integrada
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwFdIeZfTcIFulp1wvvalE1So0XUO70MRZPL_TzYoL4osf-WwKsTUgqzAc4fssSTLQ2/exec';

// Mostrar campos extra seg√∫n tipo
tipoSolicitud.addEventListener('change', () => {
    const value = tipoSolicitud.value;
    if(value==='MODIFICACI√ìN'){ modBajaFields.style.display='block'; modFields.style.display='block';}
    else if(value==='BAJA'){ modBajaFields.style.display='block'; modFields.style.display='none';}
    else{ modBajaFields.style.display='none'; modFields.style.display='none';}
});

// Tabs
tabs.forEach(tab=>{tab.addEventListener('click',()=>{
    tabs.forEach(t=>t.classList.remove('active'));
    tab.classList.add('active');
    tabContents.forEach(c=>c.classList.remove('active'));
    document.getElementById(tab.dataset.tab).classList.add('active');
    if(tab.dataset.tab==='history') loadHistory();
})});

// Enviar formulario
form.addEventListener('submit', e=>{
    e.preventDefault();
    const formData=new FormData(form);
    const data={};
    formData.forEach((v,k)=>data[k]=v);

    fetch(WEB_APP_URL,{
        method:'POST',
        body: JSON.stringify(data),
        headers:{'Content-Type':'application/json'}
    })
    .then(r=>r.json())
    .then(resp=>{
        if(resp.result==='success'){
            confirmationMsg.classList.add('show');
            form.reset(); modBajaFields.style.display='none'; modFields.style.display='none';
            window.scrollTo({top:0, behavior:'smooth'});
            setTimeout(()=>confirmationMsg.classList.remove('show'),5000);
        } else {
            alert('Error al enviar la solicitud: ' + JSON.stringify(resp));
        }
    })
    .catch(err=>{
        console.error(err);
        alert('Error al enviar la solicitud. Revisa la consola para m√°s detalles.');
    });
});

// Cargar historial
function loadHistory(){
    historyTableBody.innerHTML='<tr><td colspan="6">Cargando...</td></tr>';
    fetch(WEB_APP_URL)
    .then(r=>r.json())
    .then(data=>{
        historyTableBody.innerHTML='';
        if(data.length===0){ historyTableBody.innerHTML='<tr><td colspan="6">No hay solicitudes</td></tr>'; return;}
        data.reverse().forEach(item=>{
            const tr=document.createElement('tr');
            tr.innerHTML=`<td>${item['Tipo de solicitud']}</td>
                           <td>${item['Nombre del documento']}</td>
                           <td>${item['Tipo de documento']}</td>
                           <td>${item['√Årea responsable']}</td>
                           <td>${item['Solicitante']}</td>
                           <td>${item['Fecha de solicitud']}</td>`;
            historyTableBody.appendChild(tr);
        });
    }).catch(err=>{ historyTableBody.innerHTML='<tr><td colspan="6">Error al cargar</td></tr>'; console.error(err); });
}
</script>
</body>
</html>
